{% extends 'base.html' %}
{% load static %}
{% block title %}Analytics - Basix{% endblock %}
{% block content %}

<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="{% static 'styles.css' %}">

<div class="page">
  <section class="analytics-section container">
    <!-- Header -->
    <div class="analytics-header">
      <h2>Analytics Dashboard</h2>
      <div class="analytics-actions">
        <select id="timeRangeSelect">
          <option value="12m">Last 12 Months</option>
          <option value="6m">Last 6 Months</option>
          <option value="30d">Last 30 Days</option>
        </select>
        <button>Export</button>
      </div>
    </div>

    <!-- KPI Cards -->
    <div class="kpi-grid">
      <div class="kpi-card">
        <div class="kpi-value">12,847</div>
        <div class="kpi-label">Total Meals Saved</div>
        <div class="kpi-trend up">+23%</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-value">1,927 kg</div>
        <div class="kpi-label">CO₂ Reduced</div>
        <div class="kpi-trend up">+18%</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-value">342</div>
        <div class="kpi-label">Active Donations</div>
        <div class="kpi-trend down">-5%</div>
      </div>
      <div class="kpi-card">
        <div class="kpi-value">94%</div>
        <div class="kpi-label">Community Impact</div>
        <div class="kpi-trend up">+12%</div>
      </div>
    </div>

    <!-- Charts -->
    <div class="charts-grid">
      <div class="chart-card">
        <h3>Meals Saved Over Time</h3>
        <canvas id="mealsChart"></canvas>
      </div>
      <div class="chart-card">
        <h3>CO₂ Reduction (kg)</h3>
        <canvas id="co2Chart"></canvas>
      </div>
    </div>

    <!-- Bottom Grid -->
    <div class="analytics-bottom">
      <!-- Donation Status -->
      <div class="chart-card">
        <h3>Donation Status</h3>
        <canvas id="donationStatusChart"></canvas>
      </div>

      <!-- Food Categories -->
      <div class="chart-card">
        <h3>Food Categories</h3>
        <ul class="donor-list">
          <li class="donor-item"><span>Vegetables</span><span class="donor-tokens">450</span></li>
          <li class="donor-item"><span>Fruits</span><span class="donor-tokens">380</span></li>
          <li class="donor-item"><span>Bakery</span><span class="donor-tokens">320</span></li>
          <li class="donor-item"><span>Dairy</span><span class="donor-tokens">280</span></li>
          <li class="donor-item"><span>Prepared</span><span class="donor-tokens">180</span></li>
        </ul>
      </div>

      <!-- Top Donors -->
      <div class="chart-card">
        <h3>Top Donors</h3>
        <ul class="donor-list">
          <li class="donor-item"><span class="donor-rank">#1 Green Grocers</span><span class="donor-tokens">1250</span></li>
          <li class="donor-item"><span class="donor-rank">#2 Fresh Market Co</span><span class="donor-tokens">1180</span></li>
          <li class="donor-item"><span class="donor-rank">#3 Community Kitchen</span><span class="donor-tokens">1050</span></li>
          <li class="donor-item"><span class="donor-rank">#4 Healthy Bites</span><span class="donor-tokens">890</span></li>
          <li class="donor-item"><span class="donor-rank">#5 Corner Bakery</span><span class="donor-tokens">780</span></li>
          <li class="donor-item"><span class="donor-rank">#6 Orchard Fresh</span><span class="donor-tokens">690</span></li>
        </ul>
      </div>
    </div>
  </section>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'script.js' %}"></script>

<script>
// Initialize charts when page loads
document.addEventListener('DOMContentLoaded', function() {
  // Meals Saved Over Time Chart
  const mealsCtx = document.getElementById('mealsChart');
  if (mealsCtx) {
    new Chart(mealsCtx, {
      type: 'line',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'],
        datasets: [{
          label: 'Meals Saved',
          data: [1200, 1900, 3000, 5000, 2000, 3000, 4500, 3800, 4200, 4800, 5200, 6000],
          borderColor: '#009957',
          backgroundColor: 'rgba(0, 153, 87, 0.1)',
          tension: 0.4,
          fill: true
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }

  // CO₂ Reduction Chart
  const co2Ctx = document.getElementById('co2Chart');
  if (co2Ctx) {
    new Chart(co2Ctx, {
      type: 'bar',
      data: {
        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
        datasets: [{
          label: 'CO₂ Reduced (kg)',
          data: [120, 190, 300, 500, 200, 300],
          backgroundColor: '#009957',
          borderColor: '#009957',
          borderWidth: 1
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            display: false
          }
        },
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }

  // Donation Status Chart
  const statusCtx = document.getElementById('donationStatusChart');
  if (statusCtx) {
    new Chart(statusCtx, {
      type: 'doughnut',
      data: {
        labels: ['Completed', 'Pending', 'In Progress'],
        datasets: [{
          data: [65, 25, 10],
          backgroundColor: ['#009957', '#ffc107', '#17a2b8'],
          borderWidth: 0
        }]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: {
          legend: {
            position: 'bottom'
          }
        }
      }
    });
  }
});
</script>

{% endblock %}
